// Author: Drunkie
// Song: Kesha - Blow

// Set track wave to channel 0 and start
wset 0,trackwave;
chwave 0,0;
chstart 0;

// Set base wave to channel 0 and start
wset 1,basswave;
chwave 1,1;
chstart 1;

// Get track length
tracklen = strlen(track);

void main()
{
    // Tempo
    if (i >= 130)
        tempo( 680 );
    else
        tempo( 300 );

    // Track
    note = 2;
    fpwr note,(track[i]/12);
    note /= 100;
    chpitch 0,note;
    
    // Bass
    note = 2;
    fpwr note,(bass[i]/12);
    note /= 100;
    chpitch 1,note;
    
    // Index
    i++; mod i,tracklen;
    
    // Repeat
    jmp main;
}

// Accurate tempo function for beats-per-minute
void tempo( float bpm )
{
    timer timestamp;
    while ((time - timestamp) < (60 / bpm)) { timer time; }
}

// Returns the length of a string
float strlen(char* str)
{
  char* strptr = str;
  while (*strptr++);
  return (strptr - str);
}

float note, i;
float tracklen;
float time, timestamp;

string trackwave,"synth/triangle_880.wav";
string basswave,"synth/sine_440.wav";

track:
db -1,-1,-1,-1, 77,-1,77,-1, 77,-1,77,-1, 75,77,78,77, -1,-1,73,75, 77,78,77,-1, -1,73,75,73, 72,70,-1,-1, -1,-1,-1,-1;
db 77,-1,77,-1, 77,-1,77,-1, 75,77,78,77, -1,-1,73,75, 77,78,77,-1, -1,73,75,73, 72,70,-1,-1, -1,-1,-1,-1;
db 84,84,84,82, 82,77,80,80, 78,78,73,73, 73,75,-1,80, 80,-1,78,73, 73,73,75,78, 77,77,77,-1, -1,-1,-1,-1;
db 84,84,84,82, 82,77,80,80, 78,78,73,73, 73,75,-1,80, 80,-1,78,73, 73,73,75,78, 77,77,77,-1, -1,-1,-1,-1;
db 70,-1,70,-1, 70,-1,70,-1, 70,-1,70,70, 70,70,70,-1, 82,82,82,-1, 82,-1,82,-1, 82,-1,80,80, 80,-1,80,80, 80,-1,77,77, 77,77,-1,-1 -1,-1,-1,-1;
db 70,70,70,70, 70,70,-1,82, 82,82,82,-1, 82,-1,82,-1, 82,-1,80,80, 80,-1,80,80, 80,-1,77,77, 77,77,77,77, -1,-1,-1,-1;
db 70,70,70,70, 70,70,-1,82, 82,82,82,-1, 82,-1,82,-1, 82,-1,80,80, 80,-1,80,80, 80,-1,77,77, 77,77,77,77, -1,-1,-1,-1;
db 70,70,70,70, 70,70,-1,82, 82,82,-1,82, 82,82,-1,82, 82,-1,80,80, -1,80,80,-1, 80,80,-1,77, 77,77,77,77, -1,-1,-1,-1;

db 0; // End string

bass: 
db -1,-1,-1,-1, 70,-1,-1,82, -1,-1,70,-1, 70,-1,-1,82, -1,70,-1,70, -1,-1,82,-1, 70,-1,70,-1, -1,-1,-1,-1, -1,-1,-1,-1;
db 70,-1,-1,82, -1,-1,70,-1, 70,-1,-1,82, -1,70,-1,70, -1,-1,82,-1, 70,-1,70,-1, -1,82,-1,-1, -1,-1,-1,-1;
db 70,-1,70,70, 82,82,70,-1, 70,70,-1,82, 82,82,-1,70, 70,-1,70,-1, 82,82,82,70, -1,70,-1,-1, 82,82,-1,-1;
db 70,-1,70,70, 82,82,70,-1, 70,70,-1,82, 82,82,-1,70, 70,-1,70,-1, 82,82,82,70, -1,70,-1,-1, 82,82,-1,-1;
db 82,82,82,-1, -1,-1,70,70, 70,-1,70,70, 70,70,70,-1, 82,82,82,-1, -1,-1,70,70, 70,-1,70,70, 70,-1,-1,-1, 82,82,82,82, -1,-1,-1,-1, -1,-1,-1,-1;
db 70,70,70,-1, -1,-1,-1,82, 82,82,-1,-1, -1,-1,70,70, -1,-1,70,70, 70,-1,-1,-1, 82,82,82,82, -1,-1,-1,-1, -1,-1,-1,-1;
db 70,70,70,-1, -1,-1,-1,82, 82,82,-1,-1, -1,-1,70,70, -1,-1,70,70, 70,-1,-1,-1, 82,82,82,82, -1,-1,-1,-1, -1,-1,-1,-1;
db 70,70,70,-1, -1,-1,-1,82, 82,82,-1,-1, 70,70,70,-1, -1,-1,70,70, 70,-1,-1,-1, 82,82,82,82, 82,82,-1,-1, -1,-1,-1,-1;

db 0; // End string

